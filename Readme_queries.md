Follow these instructions to run ggCaller and query datasets effectively.



## Running ggCaller on Datasets
First, you need to execute ggCaller on a set of genomes. A typical run, which involves annotating a De Bruijn Graph (DBG) and saving intermediate data structures, can be done as follows:

### Preparing Input Files 
The `input.txt` should contain absolute paths to all genomes in the dataset folder.
1. **Create an input file listing all genomes:**
   - Navigate to the folder containing the genome datasets:
     ```
     cd folder_containing_dataset
     ```
   - Generate the `input.txt` file:
     ```
     ls -d -1 $PWD/*.fa > input.txt
     ```
     Note: If your files are in the format `.fasta`, use:
     ```
     ls -d -1 $PWD/*.fasta > input.txt
     ```
   - Return to the previous directory:
     ```
     cd ..
     ```


### Run ggCaller

2. **Run ggCaller:**
   - Simple standard command that I use:
     ```
     ggcaller --refs folder_containing_dataset/input.txt --save --out ggc_output --threads 4
     ```
   - example of using `bsub` for job submission:
     ```
     bsub -n 16 -J "ggc_Bentley" -o ggc_Bentley_out.txt -e ggc_Bentley_err.txt "ggcaller --refs folder_containing_dataset/input.txt --save --out ggc_output --threads 4"
     ```

Output Files

ggCaller generates the following files in the dataset folder:

input.gfa
input.color.bfg
Additionally, ggc_data is stored in the ggc_output folder.


## Querying a Dataset with ggCaller
After running ggCaller and obtaining the output:
Prepare for querying:
In the ggc_Bentley_et_all folder, you will find the output of the Panaroo graph, final_graph.gml. Copy this path and integrate it into your graph_traversal.py function.
1. **Set up the query environment:**
   - Navigate to the ggcaller directory and open `graph_traversal.py` for editing:
     ```
     cd ggcaller
     cd ggcaller
     vim graph_traversal.py
     ```
     (In vim, tap `I` to enter insert mode, make your modifications, press `Esc`, and type `:wq` to save and exit.)

2. **Update the path of the panaroo graph in your function: -- This part needs more perfection from me...**
   - Example path modification (line 21) [here](https://github.com/Lalemaouloud/MAGGImpute/blob/0463aee87337f7e0980975503a1be33cd6a89bec/scripts/MAGs_querying/graph_traversal.py#L21).

   - After adding your reference Install the updated setup:
     ```
     cd ..
     python setup.py install
     ```
After updating, ggCaller will successfully reference the correct Panaroo graph.


3. **Run ggCaller to query the dataset:**
   - Standard query command:
     ```
     ggcaller --query folder_containing_dataset/input.txt --graph input.gfa --colours input.color.bfg --data ggc_bsac_collection/ggc_data --out Matched_genes --threads 4
     ```
   - Using `bsub` for job submission:
     ```
     bsub -n 16 -J "ggc_output" -o ggc_output_out.txt -e ggc_output_err.txt "ggcaller --query folder_containing_dataset/input.txt --graph input.gfa --colours input.color.bfg --data ggc_bsac_collection/ggc_data --out Matched_genes --threads 4"
     ```
**Note**: Before querying, ensure that the function in `graph_traversal.py` includes the correct path to the Panaroo graph generated by ggCaller for each dataset. Additionally, remember to execute `python setup.py install` each time you make modifications to this function. Before executing any commands, verify that all necessary files are present in the folder.


